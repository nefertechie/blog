<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Root of Un-Trust | Nefertechie Blog</title>
<meta name=keywords content><meta name=description content="Introduction
Recently, I received a couple of Kingdel branded mini PCs as a favor for some work I did. The machines all came with an Intel quad core processor, 16GB of DDR3 RAM, dual Realtek NICS and were all silent. I thought they&rsquo;d be perfect for a small Proxmox virtualization environment, especially since they all supported dual MSATA flash disks. This blog post will document my experience analyzing these devices to determine whether they are fit for use in my lab."><meta name=author content="David Hillman"><link rel=canonical href=http://localhost:1313/posts/root-of-untrust/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/root-of-untrust/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Nefertechie Blog (Alt + H)">Nefertechie Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/ title=Home><span>Home</span></a></li><li><a href=http://localhost:1313/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://github.com/nefertechie title=Contents><span>Contents</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Root of Un-Trust</h1><div class=post-meta><span title='2024-11-13 01:01:49 -0500 EST'>November 13, 2024</span>&nbsp;·&nbsp;David Hillman</div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Recently, I received a couple of Kingdel branded mini PCs as a favor for some work I did. The machines all came with an Intel quad core processor, 16GB of DDR3 RAM, dual Realtek NICS and were all silent. I thought they&rsquo;d be perfect for a small Proxmox virtualization environment, especially since they all supported dual MSATA flash disks. This blog post will document my experience analyzing these devices to determine whether they are fit for use in my lab.</p><h2 id=teardown>Teardown<a hidden class=anchor aria-hidden=true href=#teardown>#</a></h2><p>I started my assessment of these tiny devices by booting up each one to see whether they worked. All devices booted up perfectly to Windows. Next, I opened up the back panel to check out the hardware. All of the devices came with a single Samsung 240GB MSATA disk and Intel wireless card. Next, I looked for any BIOS upgrades that might be available, and that&rsquo;s where the problems started. The manufacturer website (<a href=https://kingdel.com/cn>https://kingdel.com/cn</a>) showed no BIOS images available. I then searched the BIOS maker website&ndash;American Megatrends&ndash;but came up empty handed. According to the website, Kingdel is based out of Shenzhen, China.</p><p><img alt="Kingdel PC" loading=lazy src=/05_kingdel_pc.jpg title="Kingdel PC"></p><h2 id=linux-os-installation>Linux OS Installation<a hidden class=anchor aria-hidden=true href=#linux-os-installation>#</a></h2><p>Next steps were to install the OS I had been running for a year on various desktops in my lab, Fedora Silverblue. I figured I could at least use the Privacy & Security tools to assess device security. Silverblue installation went off without a hitch. I was even able to install the usual suite of software I use on a Linux desktop: Firefox flatpack version, Inkscape, LibreOffice, Teams for Linux, Ungoogled Chromium, Visual Studio Code, etc. Everything worked just as expected.</p><h2 id=firmware-assessment>Firmware Assessment<a hidden class=anchor aria-hidden=true href=#firmware-assessment>#</a></h2><p>Using the Privacy & Security tools, I was able to determine the device didn&rsquo;t have SecureBoot enabled. This is important to device and data security because Secure Boot uses cryptographic signatures to verify code integrity as the device boots. Two critical databases are involved in this process: an Allow DB (db) of approved components and a Disallow DB (dbx) of vulnerable or malicious components&ndash;firmware code, drivers, bootloaders, shims etc. A Key Exchange Key (KEK) protects these databases from being modified inappropriately. All of this is then verified by a Platform Key (PK), which serves as the root of trust for firmware updates. PK is not used as part of the boot process, but it is still pretty important. The dbx, db, and KEK are what&rsquo;s used to verify signatures for any objects loaded at boot time, including the operating system images. I was not surprised when the firmware tools revealed some outdated objects present on these systems. Even worse, the firmware was signed by a PK that was invalidated.</p><p><img alt="Device Checks" loading=lazy src=/00_device_checks_result.jpg title="Device Checks"></p><h2 id=vulnerability-note-vu455367---insecure-platform-key-pk-used-in-uefi-system>Vulnerability Note VU#455367 - Insecure Platform Key (PK) used in UEFI System<a hidden class=anchor aria-hidden=true href=#vulnerability-note-vu455367---insecure-platform-key-pk-used-in-uefi-system>#</a></h2><p>According to the description for this vulnerability and the UEFI standard, there is to be a trust relationship using Public Key Infrastructure (PKI) between a platform owner, platform firmware, and the operating system. Central to everything is the Platform Key, which is designed to secure this trust connection between the platform owner and the platform firmware. The PKFail vulnerability highlighted a critical flaw in the entire UEFI ecosystem. The PK is supposed to originate from the Original Equipment Manufacturer (OEM) using a hardware security module (HSM) to proctect the key, but in practice software keys (softkeys) are hard-coded for ease of building and testing. One of these test keys did make its way onto production firmware like the one running on the Kingdel devices. This is a serious issue because UEFI firmware is pretty much invisible to Endpoint Detection and Response (EDR) tools, making it difficult to detect the use of compromised keys. Remote measurement could dynamically check the key database for integrity problems, but most UEFI implementations lack this capability.</p><h2 id=assess-using-fwupdmgr-tools>Assess Using fwupdmgr Tools<a hidden class=anchor aria-hidden=true href=#assess-using-fwupdmgr-tools>#</a></h2><p>The fwupd project (<a href=https://github.com/fwupd/fwupd>https://github.com/fwupd/fwupd</a>) aims to make firmware updates on Linux automatic, safe, and reliable. The tools can be installed using Snap or Flatpak if they are not already installed. Bleeding edge versions can be compiled, but should not be considered a replacement for the distro-provided version installed on the system. The tools are configured by default to download firmware from Linux Vendor Firmware Service (LVFS). The service is available to all OEMs and firmware authors who would like to make firmware available through Linux.</p><p><img alt="AMI BIOS Do Not Use" loading=lazy src=/03_ami_bios_do_not_use.jpg title="AMI BIOS Do Not Use"></p><p>###Check Device Supported by fwupd</p><ul><li><p>fwupdmgr get-devices
This displays all devices detected by fwupd. [img]</p></li><li><p>fwupdmgr refresh
Download the latest metadata from LVFS</p></li><li><p>fwupdmgr update
Download and apply all updates for the system</p></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Nefertechie Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>